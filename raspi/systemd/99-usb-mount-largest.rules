# Filmkorn: auto-mount the largest partition of newly attached USB storage to /mnt/usb
# and unmount /mnt/usb when the drive is removed.
#
# NOTE: USB-to-SATA bridges may report ID_BUS=ata. We match /dev/sdX instead.

# On add/change of a disk, run the mount script (it will pick the largest partition).
ACTION=="add|change", SUBSYSTEM=="block", ENV{DEVTYPE}=="disk", KERNEL=="sd[a-z]", \
  TAG+="systemd", ENV{SYSTEMD_WANTS}+="usb-mount-largest@%k.service"

# On removal, unmount /mnt/usb. Trigger on both the partition and the disk removal events.
# ACTION=="remove", SUBSYSTEM=="block", ENV{DEVTYPE}=="partition", KERNEL=="sd[a-z][0-9]*", \
#   TAG+="systemd", ENV{SYSTEMD_WANTS}+="usb-umount@%k.service"

ACTION=="remove", SUBSYSTEM=="block", ENV{DEVTYPE}=="disk", KERNEL=="sd[a-z]", \
  TAG+="systemd", ENV{SYSTEMD_WANTS}+="usb-umount@%k.service"
